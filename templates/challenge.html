<html lang="en-US" dir="ltr">
<head>
    <title>Just a moment...</title>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex,nofollow">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body {
            margin: 0;
            font-family: system-ui, -apple-system, sans-serif;
            background: #f5f6f7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .wrapper {
            text-align: center;
            max-width: 480px;
            padding: 2rem;
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: .5rem;
        }
        h1 img {
            width: 24px;
            height: 24px;
        }
        .message {
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }
        .loader {
            display: inline-block;
            position: relative;
            width: 64px;
            height: 64px;
        }
        .loader div {
            box-sizing: border-box;
            display: block;
            position: absolute;
            width: 48px;
            height: 48px;
            margin: 8px;
            border: 5px solid #666;
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            border-color: #666 transparent transparent transparent;
        }
        .loader div:nth-child(1) { animation-delay: -0.45s; }
        .loader div:nth-child(2) { animation-delay: -0.3s; }
        .loader div:nth-child(3) { animation-delay: -0.15s; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        footer {
            margin-top: 2rem;
            font-size: .85rem;
            color: #777;
        }
        code {
            background: #eee;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .captcha-container {
            display: block;
        }
        .altcha {
            margin: auto;
        }
        :root {
            --altcha-border-width: 1px;
            --altcha-border-radius: 9px;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: #1e1f21;
                color: #e0e0e0;
            }
            .loader div {
                border-color: #bbb transparent transparent transparent;
            }
            footer {
                color: #aaa;
            }
            code {
                background: #2a2b2d;
                color: #e0e0e0;
            }
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <h1>{{ domain }}</h1>
        <p class="message">Verifying you are human. This may take a few seconds...</p>
        <div class="loader">
            <div></div><div></div><div></div><div></div>
        </div>
        <div class="captcha-container">
            <altcha-widget id="altcha" hidefooter hidelogo></altcha-widget>
        </div>
        <footer>
            Request ID: <code>{{ request_id }}</code>
        </footer>
    </div>
    <script async defer src="/__pingora/static/altcha.min.js" type="module"></script>
    <script>
        window.addEventListener('load', async () => {
            document.querySelector(".loader").style.display = "none";
            const response = await fetch(location.protocol + "//{{ domain }}/__pingora/challenge");

            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();

            document.querySelector('#altcha').configure({
                challenge: {
                    algorithm: data.algorithm,
                    challenge: data.challenge,
                    salt: data.salt,
                    signature: data.signature,
                },
            });
            document.querySelector("#altcha").addEventListener("statechange", (ev) => {
                console.log("state:", ev.detail.state);
                if (ev.detail.state === "verified") {
                    document.cookie = `pingora_challenge=${ev.detail.payload}; path=/; max-age=3600; Secure; SameSite=Strict`;
                    location.reload();
                }
            });

            await document.querySelector('#altcha').verify();
        });
    </script>
</body>
</html>
<!-- client_ip: {{ client_ip }} -->
